<script>
  // Dark mode toggle
  const toggle = document.getElementById('darkToggle');
  toggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    toggle.textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
  });

  // Trade logic
  const API_URL = "https://api.wongcilik.com/trade"; // Replace with your actual endpoint

  function submitTrade(crop, price, type, card) {
    const status = document.createElement('div');
    status.style.marginTop = '12px';
    status.style.fontSize = '14px';
    status.textContent = 'Submitting trade...';
    card.appendChild(status);

    fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        crop: crop,
        price: price,
        type: type
      })
    })
    .then(response => response.json().then(data => ({ ok: response.ok, data })))
    .then(({ ok, data }) => {
      if (ok) {
        status.textContent = `✅ ${type.toUpperCase()} successful: ${data.message || 'Trade confirmed'}`;
        status.style.color = '#145c43';
      } else {
        status.textContent = `❌ Error: ${data.error || 'Trade failed'}`;
        status.style.color = '#c0392b';
      }
    })
    .catch(err => {
      status.textContent = `⚠️ Network error: ${err.message}`;
      status.style.color = '#e67e22';
    });
  }

  // Hook into crop cards
  document.querySelectorAll('.crop-card').forEach(card => {
    const cropName = card.querySelector('h3').textContent;
    const priceText = card.querySelector('.price').textContent;
    const priceValue = parseInt(priceText.replace(/\D/g, ''), 10);

    const buyBtn = card.querySelector('.actions button:nth-child(1)');
    const bidBtn = card.querySelector('.actions button:nth-child(2)');

    buyBtn.addEventListener('click', () => {
      submitTrade(cropName, priceValue, 'buy', card);
    });

    bidBtn.addEventListener('click', () => {
      submitTrade(cropName, priceValue, 'bid', card);
    });
  });
</script>

